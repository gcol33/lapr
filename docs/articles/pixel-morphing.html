<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Advanced Topics ‚Ä¢ couplr</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Advanced Topics">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">couplr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/getting-started.html">Get Started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/algorithms.html">Algorithm Details</a></li>
    <li><a class="dropdown-item" href="../articles/matching-workflows.html">Matching Workflows</a></li>
    <li><a class="dropdown-item" href="../articles/pixel-morphing.html">Pixel Morphing &amp; Scientific Applications</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="dropdown-item" href="../news/index.html">Version 1.0.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gcol33/couplr" aria-label="GitHub"><span class="fa fab fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Advanced Topics</h1>
                        <h4 data-toc-skip class="author">Gilles
Colling</h4>
            
            <h4 data-toc-skip class="date">2025-11-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/gcol33/couplr/blob/HEAD/vignettes/pixel-morphing.Rmd" class="external-link"><code>vignettes/pixel-morphing.Rmd</code></a></small>
      <div class="d-none name"><code>pixel-morphing.Rmd</code></div>
    </div>

    
    
<style>
.pixel-row {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 8px;
}

.pixel-row img {
  flex: 0 0 25%;
  max-height: 80px;
  height: auto;
  object-fit: contain;
}

/* 2√ó2 on mobile */
@media (max-width: 600px) {
  .pixel-row img {
    flex: 0 0 50%;
    max-height: 40px;
  }
}
</style>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This vignette serves three purposes:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Build intuition</strong>: Use pixel morphing as a visual
analogy for assignment problems</li>
<li>
<strong>Scale up</strong>: Demonstrate approximation strategies when
exact LAP becomes infeasible</li>
<li>
<strong>Scientific applications</strong>: Show how matching applies
to ecology, physics, and chemistry</li>
</ol>
<p><strong>This vignette is different</strong>: Unlike the other couplr
documentation, it emphasizes <em>understanding</em> over <em>doing</em>.
If you‚Äôre looking to solve a matching problem today, start with
<code><a href="../articles/getting-started.html">vignette("getting-started")</a></code> or
<code><a href="../articles/matching-workflows.html">vignette("matching-workflows")</a></code>. Come here when you want to
understand <em>why</em> these algorithms work and <em>when</em>
approximations are appropriate.</p>
<div class="section level3">
<h3 id="who-this-vignette-is-for">Who This Vignette Is For<a class="anchor" aria-label="anchor" href="#who-this-vignette-is-for"></a>
</h3>
<p><strong>Audience</strong>: Advanced users, researchers, algorithm
developers, curious minds</p>
<p><strong>Prerequisites</strong>:</p>
<ul>
<li>Familiarity with <code><a href="../reference/lap_solve.html">lap_solve()</a></code>
(<code><a href="../articles/getting-started.html">vignette("getting-started")</a></code>)</li>
<li>Basic complexity analysis (Big-O notation)</li>
<li>Interest in algorithm design or scientific computing</li>
</ul>
<p><strong>What You‚Äôll Learn</strong>:</p>
<ul>
<li>Why exact LAP becomes infeasible for large n</li>
<li>Three approximation strategies and their trade-offs</li>
<li>How matching problems appear in ecology, physics, and chemistry</li>
<li>Mathematical connections to optimal transport theory</li>
</ul>
<p><strong>Time to complete</strong>: 45-60 minutes (conceptual
reading)</p>
</div>
<div class="section level3">
<h3 id="documentation-roadmap">Documentation Roadmap<a class="anchor" aria-label="anchor" href="#documentation-roadmap"></a>
</h3>
<table class="table">
<colgroup>
<col width="34%">
<col width="24%">
<col width="41%">
</colgroup>
<thead><tr class="header">
<th>Vignette</th>
<th>Focus</th>
<th>Difficulty</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Getting Started</td>
<td>Basic LAP solving, API introduction</td>
<td>Beginner</td>
</tr>
<tr class="even">
<td>Algorithms</td>
<td>Mathematical foundations, solver selection</td>
<td>Intermediate</td>
</tr>
<tr class="odd">
<td>Matching Workflows</td>
<td>Production matching pipelines</td>
<td>Intermediate</td>
</tr>
<tr class="even">
<td><strong>Pixel Morphing</strong></td>
<td>Scientific applications, approximations</td>
<td>Advanced</td>
</tr>
</tbody>
</table>
<p><em>You are here: Pixel Morphing (Advanced)</em></p>
</div>
<div class="section level3">
<h3 id="why-pixels">Why Pixels?<a class="anchor" aria-label="anchor" href="#why-pixels"></a>
</h3>
<p>Pixels provide an ideal testbed for understanding assignment
problems:</p>
<ul>
<li>Each pixel is an <strong>entity</strong> with measurable
properties</li>
<li>
<strong>Color</strong> = feature (what it looks like)</li>
<li>
<strong>Position</strong> = spatial location (where it is)</li>
<li>The matching is <strong>visually verifiable</strong>‚Äîyou can see if
it worked</li>
</ul>
<p>The same algorithms that morph images smoothly also track particles
in physics, align molecules in chemistry, and match vegetation plots in
ecology.</p>
</div>
<div class="section level3">
<h3 id="scientific-applications-at-a-glance">Scientific Applications at a Glance<a class="anchor" aria-label="anchor" href="#scientific-applications-at-a-glance"></a>
</h3>
<table class="table">
<colgroup>
<col width="21%">
<col width="27%">
<col width="27%">
<col width="24%">
</colgroup>
<thead><tr class="header">
<th>Domain</th>
<th>Entities</th>
<th>Features</th>
<th>Spatial</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Ecology</strong></td>
<td>Vegetation plots</td>
<td>Species composition</td>
<td>Geographic location</td>
</tr>
<tr class="even">
<td><strong>Physics</strong></td>
<td>Particles</td>
<td>Intensity, size</td>
<td>Predicted position</td>
</tr>
<tr class="odd">
<td><strong>Chemistry</strong></td>
<td>Atoms</td>
<td>Element type</td>
<td>3D coordinates</td>
</tr>
<tr class="even">
<td><strong>Images</strong></td>
<td>Pixels</td>
<td>RGB color</td>
<td>(x, y) position</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="the-general-matching-problem">The General Matching Problem<a class="anchor" aria-label="anchor" href="#the-general-matching-problem"></a>
</h2>
<div class="section level3">
<h3 id="problem-formulation">Problem Formulation<a class="anchor" aria-label="anchor" href="#problem-formulation"></a>
</h3>
<p>Given two sets of entities
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><mo stretchy="false" form="prefix">{</mo><msub><mi>a</mi><mn>1</mn></msub><mo>,</mo><mi>‚Ä¶</mi><mo>,</mo><msub><mi>a</mi><mi>n</mi></msub><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">A = \{a_1, \ldots, a_n\}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo>=</mo><mo stretchy="false" form="prefix">{</mo><msub><mi>b</mi><mn>1</mn></msub><mo>,</mo><mi>‚Ä¶</mi><mo>,</mo><msub><mi>b</mi><mi>n</mi></msub><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">B = \{b_1, \ldots, b_n\}</annotation></semantics></math>,
find the optimal one-to-one correspondence by minimizing</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><munder><mi mathvariant="normal">min</mi><mi>œÄ</mi></munder><munderover><mo>‚àë</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>c</mi><mrow><mi>i</mi><mo>,</mo><mi>œÄ</mi><mo stretchy="false" form="prefix">(</mo><mi>i</mi><mo stretchy="false" form="postfix">)</mo></mrow></msub></mrow><annotation encoding="application/x-tex">
\min_{\pi} \sum_{i=1}^{n} c_{i,\pi(i)}
</annotation></semantics></math></p>
<p>where the cost combines feature similarity and spatial proximity:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mi>Œ±</mi><mspace width="0.167em"></mspace><msub><mi>d</mi><mtext mathvariant="normal">feature</mtext></msub><mo stretchy="false" form="prefix">(</mo><msub><mi>a</mi><mi>i</mi></msub><mo>,</mo><msub><mi>b</mi><mi>j</mi></msub><mo stretchy="false" form="postfix">)</mo><mo>+</mo><mi>Œ≤</mi><mspace width="0.167em"></mspace><msub><mi>d</mi><mtext mathvariant="normal">spatial</mtext></msub><mo stretchy="false" form="prefix">(</mo><msub><mi>ùê±</mi><mi>i</mi></msub><mo>,</mo><msub><mi>ùê±</mi><mi>j</mi></msub><mo stretchy="false" form="postfix">)</mo><mi>.</mi></mrow><annotation encoding="application/x-tex">
c_{ij} = \alpha \, d_{\text{feature}}(a_i, b_j) + \beta \, d_{\text{spatial}}(\mathbf{x}_i, \mathbf{x}_j).
</annotation></semantics></math></p>
<p><strong>Feature distance</strong>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>d</mi><mtext mathvariant="normal">feature</mtext></msub><annotation encoding="application/x-tex">d_{\text{feature}}</annotation></semantics></math>:
domain-specific similarity</p>
<ul>
<li>Ecology: Bray-Curtis dissimilarity between species vectors</li>
<li>Physics: difference in particle intensity or size<br>
</li>
<li>Chemistry: penalty for mismatched atom types<br>
</li>
<li>Images: Euclidean distance in RGB color space</li>
</ul>
<p><strong>Spatial distance</strong>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>d</mi><mtext mathvariant="normal">spatial</mtext></msub><annotation encoding="application/x-tex">d_{\text{spatial}}</annotation></semantics></math>:
physical proximity</p>
<ul>
<li>Ecology: geographic distance between plot centers<br>
</li>
<li>Physics: Euclidean distance accounting for predicted motion<br>
</li>
<li>Chemistry: 3D distance between atomic coordinates<br>
</li>
<li>Images: 2D pixel position distance</li>
</ul>
<p><strong>Weights</strong>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œ±</mi><mo>,</mo><mi>Œ≤</mi><mo>‚â•</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\alpha, \beta \ge 0</annotation></semantics></math>
balance feature matching vs.¬†spatial coherence.</p>
</div>
<div class="section level3">
<h3 id="computational-challenge">Computational Challenge<a class="anchor" aria-label="anchor" href="#computational-challenge"></a>
</h3>
<p>Exact solution: solve the full
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>√ó</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">n \times n</annotation></semantics></math>
LAP.</p>
<ul>
<li>Complexity:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false" form="prefix">(</mo><msup><mi>n</mi><mn>3</mn></msup><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">O(n^3)</annotation></semantics></math>
using Jonker-Volgenant</li>
<li>Feasible: up to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>‚âà</mo><mn>1000</mn></mrow><annotation encoding="application/x-tex">n \approx 1000</annotation></semantics></math>
(about
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>30</mn><mo>√ó</mo><mn>30</mn></mrow><annotation encoding="application/x-tex">30 \times 30</annotation></semantics></math>
images, or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1000</mn><annotation encoding="application/x-tex">1000</annotation></semantics></math>
plots/particles/atoms)<br>
</li>
<li>Prohibitive: for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>10</mn><mspace width="0.167em"></mspace><mn>000</mn></mrow><annotation encoding="application/x-tex">n = 10\,000</annotation></semantics></math>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>100</mn><mo>√ó</mo><mn>100</mn></mrow><annotation encoding="application/x-tex">100 \times 100</annotation></semantics></math>
images), runtime and memory become expensive</li>
</ul>
<p>Real applications often involve</p>
<ul>
<li>High-resolution images:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>200</mn><mo>√ó</mo><mn>200</mn><mo>=</mo><mn>40</mn><mspace width="0.167em"></mspace><mn>000</mn></mrow><annotation encoding="application/x-tex">200 \times 200 = 40\,000</annotation></semantics></math>
pixels<br>
</li>
<li>Large ecological surveys:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5000</mn><mo>+</mo></mrow><annotation encoding="application/x-tex">5000+</annotation></semantics></math>
plots<br>
</li>
<li>Particle tracking:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>10</mn><mspace width="0.167em"></mspace><mn>000</mn><mo>+</mo></mrow><annotation encoding="application/x-tex">10\,000+</annotation></semantics></math>
particles per frame<br>
</li>
<li>Molecular dynamics:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>100</mn><mspace width="0.167em"></mspace><mn>000</mn><mo>+</mo></mrow><annotation encoding="application/x-tex">100\,000+</annotation></semantics></math>
atoms</li>
</ul>
<p>We therefore need approximations that are much faster but still
produce high-quality matchings.</p>
</div>
</div>
<div class="section level2">
<h2 id="visual-illustration-pixel-morphing">Visual Illustration: Pixel Morphing<a class="anchor" aria-label="anchor" href="#visual-illustration-pixel-morphing"></a>
</h2>
<p>To make the abstract ideas concrete, we visualize them using image
morphing where</p>
<ul>
<li>entities = pixels<br>
</li>
<li>features = RGB color values<br>
</li>
<li>spatial position =
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(x, y)</annotation></semantics></math>
coordinates</li>
</ul>
<p>We first show the static input images (all at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>80</mn><mo>√ó</mo><mn>80</mn></mrow><annotation encoding="application/x-tex">80 \times 80</annotation></semantics></math>
for display), then the animated morphs produced by different matching
strategies.</p>
<div class="pixel-row">
<p><img src="images/ImageA_80.png" alt="Source image A: photograph"><img src="images/ImageB_80.png" alt="Target image B: photograph"><img src="images/circleA_80.png" alt="Source image A: circle icon"><img src="images/circleB_80.png" alt="Target image B: circle icon"></p>
</div>
<p>The first pair are real photographs, the second pair are simple
geometric shapes. Internally, all matching is computed on logical
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>40</mn><mo>√ó</mo><mn>40</mn></mrow><annotation encoding="application/x-tex">40 \times 40</annotation></semantics></math>
grids; we then upscale to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>80</mn><mo>√ó</mo><mn>80</mn></mrow><annotation encoding="application/x-tex">80 \times 80</annotation></semantics></math>
purely for clearer display.</p>
<div class="section level3">
<h3 id="exact-pixel-matching">Exact Pixel Matching<a class="anchor" aria-label="anchor" href="#exact-pixel-matching"></a>
</h3>
<p>The exact pixel morph uses a full LAP solution on a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1600</mn><mo>√ó</mo><mn>1600</mn></mrow><annotation encoding="application/x-tex">1600 \times 1600</annotation></semantics></math>
cost matrix. For each pair of pixels
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">(</mo><mi>i</mi><mo>,</mo><mi>j</mi><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(i, j)</annotation></semantics></math>
we compute</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mi>Œ±</mi><mspace width="0.167em"></mspace><msub><mrow><mo stretchy="true" form="prefix">‚Äñ</mo><msubsup><mtext mathvariant="normal">RGB</mtext><mi>i</mi><mi>A</mi></msubsup><mo>‚àí</mo><msubsup><mtext mathvariant="normal">RGB</mtext><mi>j</mi><mi>B</mi></msubsup><mo stretchy="true" form="postfix">‚Äñ</mo></mrow><mn>2</mn></msub><mo>+</mo><mi>Œ≤</mi><mspace width="0.167em"></mspace><msub><mrow><mo stretchy="true" form="prefix">‚Äñ</mo><mo stretchy="false" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>,</mo><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="false" form="postfix">)</mo><mo>‚àí</mo><mo stretchy="false" form="prefix">(</mo><msub><mi>x</mi><mi>j</mi></msub><mo>,</mo><msub><mi>y</mi><mi>j</mi></msub><mo stretchy="false" form="postfix">)</mo><mo stretchy="true" form="postfix">‚Äñ</mo></mrow><mn>2</mn></msub><mo>,</mo></mrow><annotation encoding="application/x-tex">
c_{ij} = \alpha \,\lVert \text{RGB}_i^A - \text{RGB}_j^B \rVert_2 +
         \beta \,\lVert (x_i, y_i) - (x_j, y_j) \rVert_2,
</annotation></semantics></math></p>
<p>where color distances are normalized to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">[</mo><mn>0</mn><mo>,</mo><msqrt><mn>3</mn></msqrt><mo stretchy="false" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">[0, \sqrt{3}]</annotation></semantics></math>
(RGB in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">[</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="false" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">[0,1]</annotation></semantics></math>)
and spatial distances to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">[</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="false" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">[0,1]</annotation></semantics></math>
using the image diagonal.</p>
<div class="pixel-row">
<p><img src="images/image_exact.gif" alt="Animated GIF showing exact pixel morphing between two photographs"><img src="images/circle_exact.gif" alt="Animated GIF showing exact pixel morphing between two circle icons"></p>
</div>
<p>This yields an optimal one-to-one assignment of pixels. The resulting
animations are smooth and artifact-free but require solving the full
LAP.</p>
</div>
<div class="section level3">
<h3 id="feature-quantization-morph-strategy-1">Feature Quantization Morph (Strategy 1)<a class="anchor" aria-label="anchor" href="#feature-quantization-morph-strategy-1"></a>
</h3>
<div class="pixel-row">
<p><img src="images/image_color_walk.gif" alt="Animated GIF showing feature quantization morphing between two photographs"><img src="images/circle_color_walk.gif" alt="Animated GIF showing feature quantization morphing between two circle icons"></p>
</div>
<p>In the feature quantization morph, similar colors are grouped, and
groups are matched rather than individual pixels. Colors move as
coherent ‚Äúbands,‚Äù preserving global color structure but losing
fine-grained per-pixel detail.</p>
</div>
<div class="section level3">
<h3 id="hierarchical-morph-strategy-2">Hierarchical Morph (Strategy 2)<a class="anchor" aria-label="anchor" href="#hierarchical-morph-strategy-2"></a>
</h3>
<div class="pixel-row">
<p><img src="images/image_recursive.gif" alt="Animated GIF showing hierarchical morphing between two photographs"><img src="images/circle_recursive.gif" alt="Animated GIF showing hierarchical morphing between two circle icons"></p>
</div>
<p>The hierarchical morph first matches large patches, then refines
within patches. The motion is locally coherent and scales well to large
problems, at the price of potentially missing some globally optimal
cross-patch matches.</p>
</div>
</div>
<div class="section level2">
<h2 id="three-approximation-strategies">Three Approximation Strategies<a class="anchor" aria-label="anchor" href="#three-approximation-strategies"></a>
</h2>
<p>We now describe the three approximation strategies in detail. The
animations above correspond directly to these methods.</p>
<div class="section level3">
<h3 id="strategy-1-feature-quantization">Strategy 1: Feature Quantization<a class="anchor" aria-label="anchor" href="#strategy-1-feature-quantization"></a>
</h3>
<p><strong>Core idea</strong>: reduce problem size by grouping entities
with similar features, then match groups.</p>
<div class="section level4">
<h4 id="mathematical-formulation">Mathematical Formulation<a class="anchor" aria-label="anchor" href="#mathematical-formulation"></a>
</h4>
<ol style="list-style-type: decimal">
<li><strong>Quantize features</strong></li>
</ol>
<p>Map continuous feature space to a finite palette</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">quantize</mtext><mo>:</mo><msup><mi>‚Ñù</mi><mi>d</mi></msup><mo>‚Üí</mo><mo stretchy="false" form="prefix">{</mo><mn>1</mn><mo>,</mo><mi>‚Ä¶</mi><mo>,</mo><mi>k</mi><mo stretchy="false" form="postfix">}</mo><mo>,</mo></mrow><annotation encoding="application/x-tex">
\text{quantize}: \mathbb{R}^d \to \{1, \ldots, k\},
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>‚â™</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">k \ll n</annotation></semantics></math>
(for example
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>‚âà</mo><mn>64</mn></mrow><annotation encoding="application/x-tex">k \approx 64</annotation></semantics></math>
for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>1600</mn></mrow><annotation encoding="application/x-tex">n = 1600</annotation></semantics></math>).</p>
<ol start="2" style="list-style-type: decimal">
<li><strong>Group by palette</strong></li>
</ol>
<p>Form groups
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>G</mi><mi>A</mi><mrow><mo stretchy="false" form="prefix">(</mo><mi>c</mi><mo stretchy="false" form="postfix">)</mo></mrow></msubsup><mo>=</mo><mo stretchy="false" form="prefix">{</mo><mi>i</mi><mo>:</mo><mtext mathvariant="normal">quantize</mtext><mo stretchy="false" form="prefix">(</mo><msub><mi>f</mi><mi>i</mi></msub><mo stretchy="false" form="postfix">)</mo><mo>=</mo><mi>c</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">
G_A^{(c)} = \{ i : \text{quantize}(f_i) = c \}
</annotation></semantics></math> and similarly for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>B</mi><annotation encoding="application/x-tex">B</annotation></semantics></math>.</p>
<ol start="3" style="list-style-type: decimal">
<li><strong>Match groups</strong></li>
</ol>
<p>Solve a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>√ó</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">k \times k</annotation></semantics></math>
LAP between palette entries with costs</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><msup><mi>c</mi><mo>‚Ä≤</mo></msup><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mi>Œ±</mi><mspace width="0.167em"></mspace><mi>d</mi><mo stretchy="false" form="prefix">(</mo><msub><mi>p</mi><mi>i</mi></msub><mo>,</mo><msub><mi>p</mi><mi>j</mi></msub><mo stretchy="false" form="postfix">)</mo><mo>+</mo><mi>Œ≤</mi><mspace width="0.167em"></mspace><mi>d</mi><mo stretchy="false" form="prefix">(</mo><msub><mover><mi>ùê±</mi><mo accent="true">‚Äæ</mo></mover><mi>i</mi></msub><mo>,</mo><msub><mover><mi>ùê±</mi><mo accent="true">‚Äæ</mo></mover><mi>j</mi></msub><mo stretchy="false" form="postfix">)</mo><mo>,</mo></mrow><annotation encoding="application/x-tex">
c'_{ij} = \alpha \, d(p_i, p_j) + \beta \, d(\bar{\mathbf{x}}_i, \bar{\mathbf{x}}_j),
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mi>i</mi></msub><annotation encoding="application/x-tex">p_i</annotation></semantics></math>
is the palette color and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mi>ùê±</mi><mo accent="true">‚Äæ</mo></mover><mi>i</mi></msub><annotation encoding="application/x-tex">\bar{\mathbf{x}}_i</annotation></semantics></math>
the centroid position of group
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>.</p>
<ol start="4" style="list-style-type: decimal">
<li><strong>Assign entities</strong></li>
</ol>
<p>Every entity in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>G</mi><mi>A</mi><mrow><mo stretchy="false" form="prefix">(</mo><mi>c</mi><mo stretchy="false" form="postfix">)</mo></mrow></msubsup><annotation encoding="application/x-tex">G_A^{(c)}</annotation></semantics></math>
is assigned according to the group-to-group match.</p>
</div>
<div class="section level4">
<h4 id="complexity-reduction">Complexity Reduction<a class="anchor" aria-label="anchor" href="#complexity-reduction"></a>
</h4>
<ul>
<li>Original:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false" form="prefix">(</mo><msup><mi>n</mi><mn>3</mn></msup><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">O(n^3)</annotation></semantics></math>
for an
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>√ó</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">n \times n</annotation></semantics></math>
LAP<br>
</li>
<li>Quantized:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false" form="prefix">(</mo><msup><mi>k</mi><mn>3</mn></msup><mo>+</mo><mi>n</mi><mi>k</mi><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">O(k^3 + n k)</annotation></semantics></math>
for the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>√ó</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">k \times k</annotation></semantics></math>
LAP plus group assignment<br>
</li>
<li>Speedup: approximately
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">(</mo><mi>n</mi><mi>/</mi><mi>k</mi><msup><mo stretchy="false" form="postfix">)</mo><mn>3</mn></msup></mrow><annotation encoding="application/x-tex">(n/k)^3</annotation></semantics></math>
</li>
</ul>
<p>For example, with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>1600</mn></mrow><annotation encoding="application/x-tex">n = 1600</annotation></semantics></math>
(a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>40</mn><mo>√ó</mo><mn>40</mn></mrow><annotation encoding="application/x-tex">40 \times 40</annotation></semantics></math>
image) and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>64</mn></mrow><annotation encoding="application/x-tex">k = 64</annotation></semantics></math>
you get</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mn>1600</mn><mn>64</mn></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mn>3</mn></msup><mo>=</mo><msup><mn>25</mn><mn>3</mn></msup><mo>‚âà</mo><mn>15</mn><mspace width="0.167em"></mspace><mn>000</mn></mrow><annotation encoding="application/x-tex">
\left(\frac{1600}{64}\right)^3 = 25^3 \approx 15\,000
</annotation></semantics></math></p>
<p>times fewer LAP operations.</p>
</div>
<div class="section level4">
<h4 id="quality-trade-offs">Quality Trade-offs<a class="anchor" aria-label="anchor" href="#quality-trade-offs"></a>
</h4>
<p><strong>Advantages</strong></p>
<ul>
<li>Very large speedups for big
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math><br>
</li>
<li>Preserves global structure (similar features stay together)<br>
</li>
<li>Produces smooth, band-like motion without large jumps</li>
</ul>
<p><strong>Disadvantages</strong></p>
<ul>
<li>Loses detail within each palette group<br>
</li>
<li>Quantization artifacts when
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
is too small<br>
</li>
<li>May miss optimal local pairings between similar but distinct feature
values</li>
</ul>
<p>The corresponding GIFs are the <em>color walk</em> morphs shown
earlier.</p>
</div>
</div>
<div class="section level3">
<h3 id="strategy-2-hierarchical-decomposition">Strategy 2: Hierarchical Decomposition<a class="anchor" aria-label="anchor" href="#strategy-2-hierarchical-decomposition"></a>
</h3>
<p><strong>Core idea</strong>: split the domain into smaller subproblems
by spatial partitioning, solve subproblems, and combine.</p>
<div class="section level4">
<h4 id="mathematical-formulation-1">Mathematical Formulation<a class="anchor" aria-label="anchor" href="#mathematical-formulation-1"></a>
</h4>
<ol style="list-style-type: decimal">
<li><strong>Spatial partitioning</strong></li>
</ol>
<p>Divide the domain into
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>√ó</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">m \times m</annotation></semantics></math>
patches (for example
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>=</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">m = 4</annotation></semantics></math>
so you get
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>16</mn><annotation encoding="application/x-tex">16</annotation></semantics></math>
patches). Denote the subset of entities of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math>
in patch
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
by</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>P</mi><mi>A</mi><mrow><mo stretchy="false" form="prefix">(</mo><mi>k</mi><mo stretchy="false" form="postfix">)</mo></mrow></msubsup><mo>=</mo><mo stretchy="false" form="prefix">{</mo><msub><mi>a</mi><mi>i</mi></msub><mo>:</mo><msub><mi>ùê±</mi><mi>i</mi></msub><mo>‚àà</mo><msub><mtext mathvariant="normal">Patch</mtext><mi>k</mi></msub><mo stretchy="false" form="postfix">}</mo><mi>.</mi></mrow><annotation encoding="application/x-tex">
P_A^{(k)} = \{ a_i : \mathbf{x}_i \in \text{Patch}_k \}.
</annotation></semantics></math></p>
<ol start="2" style="list-style-type: decimal">
<li><strong>Patch-level matching</strong></li>
</ol>
<p>Form patch representatives: centroid position and mean features per
patch. Solve an
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>m</mi><mn>2</mn></msup><mo>√ó</mo><msup><mi>m</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">m^2 \times m^2</annotation></semantics></math>
LAP between patches, with costs defined using the same feature and
spatial distances but now at patch level.</p>
<ol start="3" style="list-style-type: decimal">
<li><strong>Recursive refinement</strong></li>
</ol>
<p>Within each matched patch pair
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">(</mo><msubsup><mi>P</mi><mi>A</mi><mrow><mo stretchy="false" form="prefix">(</mo><mi>k</mi><mo stretchy="false" form="postfix">)</mo></mrow></msubsup><mo>,</mo><msubsup><mi>P</mi><mi>B</mi><mrow><mo stretchy="false" form="prefix">(</mo><mi>l</mi><mo stretchy="false" form="postfix">)</mo></mrow></msubsup><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(P_A^{(k)}, P_B^{(l)})</annotation></semantics></math>:</p>
<ul>
<li>If
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">|</mo><msubsup><mi>P</mi><mi>A</mi><mrow><mo stretchy="false" form="prefix">(</mo><mi>k</mi><mo stretchy="false" form="postfix">)</mo></mrow></msubsup><mo stretchy="false" form="postfix">|</mo><mo>‚â§</mo><mi>œÑ</mi></mrow><annotation encoding="application/x-tex">\lvert P_A^{(k)} \rvert \le \tau</annotation></semantics></math>
(a threshold,
e.g.¬†<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>œÑ</mi><mo>=</mo><mn>50</mn></mrow><annotation encoding="application/x-tex">\tau = 50</annotation></semantics></math>)
solve the subproblem exactly.<br>
</li>
<li>Otherwise, partition that patch pair again and repeat.</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li><strong>Combine solutions</strong></li>
</ol>
<p>Concatenate assignments from all leaf subproblems to obtain the
global matching.</p>
</div>
<div class="section level4">
<h4 id="complexity-sketch">Complexity (Sketch)<a class="anchor" aria-label="anchor" href="#complexity-sketch"></a>
</h4>
<p>With
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>d</mi><annotation encoding="application/x-tex">d</annotation></semantics></math>
levels of decomposition (each level splitting into four patches), the
work can be made close to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false" form="prefix">(</mo><mi>n</mi><mrow><mi mathvariant="normal">log</mi><mo>‚Å°</mo></mrow><mi>n</mi><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">O(n \log n)</annotation></semantics></math>
in practice, compared to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false" form="prefix">(</mo><msup><mi>n</mi><mn>3</mn></msup><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">O(n^3)</annotation></semantics></math>
for a single full LAP. Intuitively, the LAPs near the leaves are very
small, and the costly large LAP is replaced by a series of much smaller
ones.</p>
</div>
<div class="section level4">
<h4 id="quality-trade-offs-1">Quality Trade-offs<a class="anchor" aria-label="anchor" href="#quality-trade-offs-1"></a>
</h4>
<p><strong>Advantages</strong></p>
<ul>
<li>Scales to very large
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
(tens of thousands of entities)<br>
</li>
<li>Preserves local structure: nearby entities tend to be matched within
the same spatial patch<br>
</li>
<li>No feature discretization, so feature precision is retained</li>
</ul>
<p><strong>Disadvantages</strong></p>
<ul>
<li>May miss globally optimal cross-patch matches<br>
</li>
<li>Quality depends on partitioning scheme and threshold
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>œÑ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math><br>
</li>
<li>Possible boundary artifacts if important structure crosses patch
boundaries</li>
</ul>
</div>
<div class="section level4">
<h4 id="high-level-algorithm">High-Level Algorithm<a class="anchor" aria-label="anchor" href="#high-level-algorithm"></a>
</h4>
<pre><code>// Pseudocode for hierarchical LAP matching

FUNCTION match_hierarchical(region_A, region_B, threshold, level):

  // Base case: region small enough for exact LAP
  IF size(region_A) &lt;= threshold THEN
    cost ‚Üê compute_cost_matrix(region_A, region_B, Œ±, Œ≤)
    RETURN lap_solve(cost)
  END IF

  // Divide into 2√ó2 spatial grid (4 patches)
  patches_A ‚Üê spatial_partition(region_A, grid = 2√ó2)
  patches_B ‚Üê spatial_partition(region_B, grid = 2√ó2)

  // Compute patch representatives
  FOR each patch p DO
    centroid[p]      ‚Üê mean(positions in p)
    mean_feature[p]  ‚Üê mean(features in p)
  END FOR

  // Match patches using 4√ó4 LAP
  patch_cost ‚Üê matrix(4, 4)
  FOR i = 1 TO 4 DO
    FOR j = 1 TO 4 DO
      patch_cost[i, j] ‚Üê Œ±¬∑distance(mean_feature_A[i], mean_feature_B[j]) +
                         Œ≤¬∑distance(centroid_A[i], centroid_B[j])
    END FOR
  END FOR

  patch_assignment ‚Üê lap_solve(patch_cost)

  // Recursively solve within matched patches
  assignments ‚Üê []
  FOR i = 1 TO 4 DO
    j ‚Üê patch_assignment[i]
    sub_assignment ‚Üê match_hierarchical(
      patches_A[i],
      patches_B[j],
      threshold,
      level + 1
    )
    assignments ‚Üê append(assignments, sub_assignment)
  END FOR

  RETURN concatenate(assignments)
END FUNCTION</code></pre>
<p>The <code>couplr</code> implementation adds pragmatic details such as
normalization of color and spatial distances, conversion between
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(x, y)</annotation></semantics></math>
coordinates and raster indexing, and handling remainder patches when the
grid does not divide evenly.</p>
</div>
</div>
<div class="section level3">
<h3 id="strategy-3-resolution-reduction">Strategy 3: Resolution Reduction<a class="anchor" aria-label="anchor" href="#strategy-3-resolution-reduction"></a>
</h3>
<p><strong>Core idea</strong>: solve the LAP on a coarse grid, then
lift/upscale the assignment to the full-resolution grid.</p>
<div class="section level4">
<h4 id="mathematical-formulation-2">Mathematical Formulation<a class="anchor" aria-label="anchor" href="#mathematical-formulation-2"></a>
</h4>
<ol style="list-style-type: decimal">
<li><strong>Downscale</strong></li>
</ol>
<p>Reduce spatial resolution by a factor
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>
(for example
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">s = 2</annotation></semantics></math>):</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>A</mi><mo>‚Ä≤</mo></msup><mo>=</mo><mtext mathvariant="normal">downsample</mtext><mo stretchy="false" form="prefix">(</mo><mi>A</mi><mo>,</mo><mi>s</mi><mo stretchy="false" form="postfix">)</mo><mo>,</mo><mspace width="2.0em"></mspace><msup><mi>B</mi><mo>‚Ä≤</mo></msup><mo>=</mo><mtext mathvariant="normal">downsample</mtext><mo stretchy="false" form="prefix">(</mo><mi>B</mi><mo>,</mo><mi>s</mi><mo stretchy="false" form="postfix">)</mo><mi>.</mi></mrow><annotation encoding="application/x-tex">
A' = \text{downsample}(A, s), \qquad B' = \text{downsample}(B, s).
</annotation></semantics></math></p>
<p>Now
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>A</mi><mo>‚Ä≤</mo></msup><annotation encoding="application/x-tex">A'</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>B</mi><mo>‚Ä≤</mo></msup><annotation encoding="application/x-tex">B'</annotation></semantics></math>
each have
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>n</mi><mo>‚Ä≤</mo></msup><mo>=</mo><mi>n</mi><mi>/</mi><msup><mi>s</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">n' = n / s^2</annotation></semantics></math>
entities.</p>
<ol start="2" style="list-style-type: decimal">
<li><strong>Solve at low resolution</strong></li>
</ol>
<p>Compute an exact LAP solution on the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>n</mi><mo>‚Ä≤</mo></msup><mo>√ó</mo><msup><mi>n</mi><mo>‚Ä≤</mo></msup></mrow><annotation encoding="application/x-tex">n' \times n'</annotation></semantics></math>
problem:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>œÄ</mi><mo>‚Ä≤</mo></msup><mo>=</mo><mrow><mi mathvariant="normal">arg</mi><mo>‚Å°</mo></mrow><munder><mi mathvariant="normal">min</mi><msup><mi>œÄ</mi><mo>‚Ä≤</mo></msup></munder><munderover><mo>‚àë</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><msup><mi>n</mi><mo>‚Ä≤</mo></msup></munderover><msub><msup><mi>c</mi><mo>‚Ä≤</mo></msup><mrow><mi>i</mi><mo>,</mo><msup><mi>œÄ</mi><mo>‚Ä≤</mo></msup><mo stretchy="false" form="prefix">(</mo><mi>i</mi><mo stretchy="false" form="postfix">)</mo></mrow></msub><mi>.</mi></mrow><annotation encoding="application/x-tex">
\pi' = \arg\min_{\pi'} \sum_{i=1}^{n'} c'_{i,\pi'(i)}.
</annotation></semantics></math></p>
<ol start="3" style="list-style-type: decimal">
<li><strong>Upscale assignment</strong></li>
</ol>
<p>Map the low-resolution assignment back to full resolution:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>œÄ</mi><mo stretchy="false" form="prefix">(</mo><mi>i</mi><mo stretchy="false" form="postfix">)</mo><mo>=</mo><mtext mathvariant="normal">upscale</mtext><mspace width="-0.167em"></mspace><mo minsize="120%" maxsize="120%" stretchy="true" form="prefix">(</mo><msup><mi>œÄ</mi><mo>‚Ä≤</mo></msup><mo stretchy="false" form="prefix">(</mo><mtext mathvariant="normal">coarse_index</mtext><mo stretchy="false" form="prefix">(</mo><mi>i</mi><mo stretchy="false" form="postfix">)</mo><mo stretchy="false" form="postfix">)</mo><mo>,</mo><mi>s</mi><mo minsize="120%" maxsize="120%" stretchy="true" form="postfix">)</mo><mo>,</mo></mrow><annotation encoding="application/x-tex">
\pi(i) = \text{upscale}\!\bigl(\pi'(\text{coarse\_index}(i)), s\bigr),
</annotation></semantics></math></p>
<p>where each full-resolution entity inherits the assignment of its
coarse cell.</p>
</div>
<div class="section level4">
<h4 id="complexity">Complexity<a class="anchor" aria-label="anchor" href="#complexity"></a>
</h4>
<ul>
<li>Original:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false" form="prefix">(</mo><msup><mi>n</mi><mn>3</mn></msup><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">O(n^3)</annotation></semantics></math><br>
</li>
<li>Downscaled:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo minsize="120%" maxsize="120%" stretchy="true" form="prefix">(</mo><mo stretchy="false" form="prefix">(</mo><mi>n</mi><mi>/</mi><msup><mi>s</mi><mn>2</mn></msup><msup><mo stretchy="false" form="postfix">)</mo><mn>3</mn></msup><mo minsize="120%" maxsize="120%" stretchy="true" form="postfix">)</mo><mo>=</mo><mi>O</mi><mo stretchy="false" form="prefix">(</mo><msup><mi>n</mi><mn>3</mn></msup><mi>/</mi><msup><mi>s</mi><mn>6</mn></msup><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">O\bigl((n/s^2)^3\bigr) = O(n^3 / s^6)</annotation></semantics></math><br>
</li>
<li>Speedup:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>s</mi><mn>6</mn></msup><annotation encoding="application/x-tex">s^6</annotation></semantics></math>
</li>
</ul>
<p>For
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">s = 2</annotation></semantics></math>
this gives a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>64</mn><mo>√ó</mo></mrow><annotation encoding="application/x-tex">64\times</annotation></semantics></math>
reduction in LAP work.</p>
</div>
<div class="section level4">
<h4 id="quality-trade-offs-2">Quality Trade-offs<a class="anchor" aria-label="anchor" href="#quality-trade-offs-2"></a>
</h4>
<p><strong>Advantages</strong></p>
<ul>
<li>Very simple to implement<br>
</li>
<li>Exact LAP at the coarse level<br>
</li>
<li>Large speedups for moderate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>
</li>
</ul>
<p><strong>Disadvantages</strong></p>
<ul>
<li>Loss of fine detail and blocky artifacts<br>
</li>
<li>Assignment is no longer a true permutation at pixel level (multiple
fine pixels can map to the same coarse target)<br>
</li>
<li>Quality deteriorates quickly for larger
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>
</li>
</ul>
<p>In practice, resolution reduction is most useful as a crude
initialization step for very large problems
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>&gt;</mo><mn>100</mn><mspace width="0.167em"></mspace><mn>000</mn></mrow><annotation encoding="application/x-tex">n &gt; 100\,000</annotation></semantics></math>).</p>
</div>
</div>
<div class="section level3">
<h3 id="strategy-comparison">Strategy Comparison<a class="anchor" aria-label="anchor" href="#strategy-comparison"></a>
</h3>
<table class="table">
<colgroup>
<col width="21%">
<col width="19%">
<col width="22%">
<col width="36%">
</colgroup>
<thead><tr class="header">
<th>Approach</th>
<th>Speedup (vs.¬†exact)</th>
<th>Quality</th>
<th>Best for</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Exact LAP</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>√ó</mo></mrow><annotation encoding="application/x-tex">1\times</annotation></semantics></math></td>
<td>Optimal</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>‚â§</mo><mn>1000</mn></mrow><annotation encoding="application/x-tex">n \le 1000</annotation></semantics></math></td>
</tr>
<tr class="even">
<td>Feature quantization</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">(</mo><mi>n</mi><mi>/</mi><mi>k</mi><msup><mo stretchy="false" form="postfix">)</mo><mn>3</mn></msup></mrow><annotation encoding="application/x-tex">(n/k)^3</annotation></semantics></math></td>
<td>Good global structure</td>
<td>Distinct feature groups</td>
</tr>
<tr class="odd">
<td>Hierarchical</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>‚âà</mo><msup><mi>n</mi><mrow><mn>3</mn><mi>/</mi><mn>2</mn></mrow></msup></mrow><annotation encoding="application/x-tex">\approx n^{3/2}</annotation></semantics></math></td>
<td>Good local structure</td>
<td>Large
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>,
strong spatial structure</td>
</tr>
<tr class="even">
<td>Resolution reduction</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>s</mi><mn>6</mn></msup><annotation encoding="application/x-tex">s^6</annotation></semantics></math></td>
<td>Moderate</td>
<td>Very large
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>,
rough initialization</td>
</tr>
</tbody>
</table>
<p><strong>Practical rules of thumb</strong></p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>&lt;</mo><mn>1000</mn></mrow><annotation encoding="application/x-tex">n &lt; 1000</annotation></semantics></math>:
use the exact LAP.<br>
</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1000</mn><mo>&lt;</mo><mi>n</mi><mo>&lt;</mo><mn>5000</mn></mrow><annotation encoding="application/x-tex">1000 &lt; n &lt; 5000</annotation></semantics></math>:
feature quantization or a shallow hierarchy.<br>
</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>&gt;</mo><mn>5000</mn></mrow><annotation encoding="application/x-tex">n &gt; 5000</annotation></semantics></math>:
hierarchical decomposition with 2-3 levels.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>&gt;</mo><mn>50</mn><mspace width="0.167em"></mspace><mn>000</mn></mrow><annotation encoding="application/x-tex">n &gt; 50\,000</annotation></semantics></math>:
combine
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">s = 2</annotation></semantics></math>
resolution reduction with a hierarchical method.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="implementation-details-of-exact-pixel-matching">Implementation Details of Exact Pixel Matching<a class="anchor" aria-label="anchor" href="#implementation-details-of-exact-pixel-matching"></a>
</h2>
<p>We now spell out the exact LAP-based morph more concretely.</p>
<p>We again use the cost</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mi>Œ±</mi><mspace width="0.167em"></mspace><msub><mrow><mo stretchy="true" form="prefix">‚Äñ</mo><msubsup><mtext mathvariant="normal">RGB</mtext><mi>i</mi><mi>A</mi></msubsup><mo>‚àí</mo><msubsup><mtext mathvariant="normal">RGB</mtext><mi>j</mi><mi>B</mi></msubsup><mo stretchy="true" form="postfix">‚Äñ</mo></mrow><mn>2</mn></msub><mo>+</mo><mi>Œ≤</mi><mspace width="0.167em"></mspace><msub><mrow><mo stretchy="true" form="prefix">‚Äñ</mo><mo stretchy="false" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>,</mo><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="false" form="postfix">)</mo><mo>‚àí</mo><mo stretchy="false" form="prefix">(</mo><msub><mi>x</mi><mi>j</mi></msub><mo>,</mo><msub><mi>y</mi><mi>j</mi></msub><mo stretchy="false" form="postfix">)</mo><mo stretchy="true" form="postfix">‚Äñ</mo></mrow><mn>2</mn></msub><mi>.</mi></mrow><annotation encoding="application/x-tex">
c_{ij} = \alpha \,\lVert \text{RGB}_i^A - \text{RGB}_j^B \rVert_2 +
         \beta \,\lVert (x_i, y_i) - (x_j, y_j) \rVert_2.
</annotation></semantics></math></p>
<p>The algorithm:</p>
<pre><code>// Pseudocode for exact pixel matching

// Step 1: Compute full cost matrix (normalized)
n_pixels ‚Üê height √ó width
cost ‚Üê matrix(0, n_pixels, n_pixels)

FOR i = 1 TO n_pixels DO
  FOR j = 1 TO n_pixels DO
    // RGB color distance (normalized to [0, sqrt(3)])
    color_dist ‚Üê sqrt((R_A[i] - R_B[j])^2 +
                      (G_A[i] - G_B[j])^2 +
                      (B_A[i] - B_B[j])^2) / (255 ¬∑ sqrt(3))

    // Spatial distance (normalized to [0, 1] by diagonal)
    spatial_dist ‚Üê sqrt((x_A[i] - x_B[j])^2 +
                        (y_A[i] - y_B[j])^2) / diagonal_length

    // Combined cost
    cost[i, j] ‚Üê Œ± ¬∑ color_dist + Œ≤ ¬∑ spatial_dist
  END FOR
END FOR

// Step 2: Solve with Jonker-Volgenant
assignment ‚Üê lap_solve(cost, method = "jv")

// Step 3: Generate morph frames by linear interpolation
FOR frame_idx = 1 TO n_frames DO
  t ‚Üê frame_idx / n_frames  // Time parameter in [0, 1]

  FOR pixel_i = 1 TO n_pixels DO
    j ‚Üê assignment[pixel_i]  // Matched target pixel

    // Interpolate position
    x_new[pixel_i] ‚Üê (1 - t) ¬∑ x_A[pixel_i] + t ¬∑ x_B[j]
    y_new[pixel_i] ‚Üê (1 - t) ¬∑ y_A[pixel_i] + t ¬∑ y_B[j]

    // Keep source color (transport-only, no blending)
    RGB_new[pixel_i] ‚Üê RGB_A[pixel_i]
  END FOR

  frames[frame_idx] ‚Üê render(x_new, y_new, RGB_new)
END FOR</code></pre>
<p>The <code>couplr</code> implementation handles indexing, raster
layout, and shows or saves the resulting GIFs.</p>
<p>Approximate performance: up to about
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>100</mn><mo>√ó</mo><mn>100</mn></mrow><annotation encoding="application/x-tex">100 \times 100</annotation></semantics></math>
(10‚ÄØ000 pixels) on typical hardware is fine with the exact LAP.</p>
</div>
<div class="section level2">
<h2 id="application-to-scientific-domains">Application to Scientific Domains<a class="anchor" aria-label="anchor" href="#application-to-scientific-domains"></a>
</h2>
<p>We now return from pixel morphs to the scientific settings that
motivated them.</p>
<div class="section level3">
<h3 id="ecology-vegetation-plot-matching">Ecology: Vegetation Plot Matching<a class="anchor" aria-label="anchor" href="#ecology-vegetation-plot-matching"></a>
</h3>
<p><strong>Problem</strong>: match
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
vegetation plots surveyed at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
plots at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>+</mo><mi mathvariant="normal">Œî</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">t + \Delta t</annotation></semantics></math>
to track community dynamics.</p>
<p><strong>Feature distance</strong>: Bray-Curtis dissimilarity between
species abundance vectors</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mtext mathvariant="normal">BC</mtext></msub><mo stretchy="false" form="prefix">(</mo><mi>a</mi><mo>,</mo><mi>b</mi><mo stretchy="false" form="postfix">)</mo><mo>=</mo><mfrac><mrow><munder><mo>‚àë</mo><mi>s</mi></munder><mo stretchy="false" form="prefix">|</mo><msub><mi>a</mi><mi>s</mi></msub><mo>‚àí</mo><msub><mi>b</mi><mi>s</mi></msub><mo stretchy="false" form="postfix">|</mo></mrow><mrow><munder><mo>‚àë</mo><mi>s</mi></munder><mo stretchy="false" form="prefix">(</mo><msub><mi>a</mi><mi>s</mi></msub><mo>+</mo><msub><mi>b</mi><mi>s</mi></msub><mo stretchy="false" form="postfix">)</mo></mrow></mfrac><mo>,</mo></mrow><annotation encoding="application/x-tex">
d_{\text{BC}}(a, b) =
\frac{\sum_s \lvert a_s - b_s \rvert}
     {\sum_s (a_s + b_s)},
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>s</mi></msub><mo>,</mo><msub><mi>b</mi><mi>s</mi></msub></mrow><annotation encoding="application/x-tex">a_s, b_s</annotation></semantics></math>
are abundances of species
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>
in plots
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>a</mi><annotation encoding="application/x-tex">a</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>b</mi><annotation encoding="application/x-tex">b</annotation></semantics></math>.</p>
<p><strong>Spatial distance</strong>: geographic distance (e.g.¬†in
kilometers) between plot centers.</p>
<p>Exact solution for small studies
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>&lt;</mo><mn>100</mn></mrow><annotation encoding="application/x-tex">n &lt; 100</annotation></semantics></math>):</p>
<pre><code>// Pseudocode for ecological plot matching
FOR i = 1 TO n_plots_t DO
  FOR j = 1 TO n_plots_tplus DO

    // Bray-Curtis dissimilarity for species composition
    numerator   ‚Üê sum over species s of |abundance_t[i, s] - abundance_tplus[j, s]|
    denominator ‚Üê sum over species s of (abundance_t[i, s] + abundance_tplus[j, s])
    bc_distance ‚Üê numerator / denominator

    // Geographic distance (kilometers)
    geo_distance ‚Üê sqrt((x_t[i] - x_tplus[j])^2 +
                        (y_t[i] - y_tplus[j])^2)

    // Combined cost (Œ± = 0.7 emphasizes species composition)
    cost[i, j] ‚Üê 0.7 ¬∑ bc_distance + 0.3 ¬∑ (geo_distance / max_distance)

  END FOR
END FOR

plot_correspondence ‚Üê lap_solve(cost)</code></pre>
<p>For large studies
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>&gt;</mo><mn>1000</mn></mrow><annotation encoding="application/x-tex">n &gt; 1000</annotation></semantics></math>)
a hierarchical approach by region is more practical:</p>
<pre><code>// Hierarchical decomposition by geographic region

// 1. Divide landscape into spatial grid (e.g. 10 km √ó 10 km cells)
regions_t     ‚Üê spatial_partition(plots_t,     grid_size = 10 km)
regions_tplus ‚Üê spatial_partition(plots_tplus, grid_size = 10 km)

// 2. Compute region representatives
FOR each region r DO
  mean_composition[r] ‚Üê average species vector across plots in r
  centroid[r]         ‚Üê geographic center of r
END FOR

// 3. Match regions (small LAP: ~100 regions)
region_cost       ‚Üê compute_cost(mean_composition, centroids, Œ± = 0.7, Œ≤ = 0.3)
region_assignment ‚Üê lap_solve(region_cost)

// 4. Within matched regions, solve plot-level LAP
full_assignment ‚Üê []
FOR r = 1 TO n_regions DO
  r_matched ‚Üê region_assignment[r]
  plots_A   ‚Üê plots in regions_t[r]
  plots_B   ‚Üê plots in regions_tplus[r_matched]

  // Local LAP (smaller problem, e.g. 50 √ó 50)
  cost_local       ‚Üê compute_plot_cost(plots_A, plots_B, Œ± = 0.7, Œ≤ = 0.3)
  local_assignment ‚Üê lap_solve(cost_local)

  full_assignment ‚Üê append(full_assignment, local_assignment)
END FOR

RETURN full_assignment</code></pre>
<p>This allows tracking individual plot trajectories across time,
distinguishing stable communities, successional trends, and invasion
fronts.</p>
</div>
<div class="section level3">
<h3 id="physics-particle-tracking">Physics: Particle Tracking<a class="anchor" aria-label="anchor" href="#physics-particle-tracking"></a>
</h3>
<p><strong>Problem</strong>: track
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
particles between frame
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>+</mo><mi mathvariant="normal">Œî</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">t + \Delta t</annotation></semantics></math>
in experimental video.</p>
<p><strong>Feature distance</strong>: differences in intensity, size, or
shape.</p>
<p><strong>Spatial distance</strong>: displacement relative to predicted
motion:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mtext mathvariant="normal">spatial</mtext></msub><mo stretchy="false" form="prefix">(</mo><mi>i</mi><mo>,</mo><mi>j</mi><mo stretchy="false" form="postfix">)</mo><mo>=</mo><mo minsize="120%" maxsize="120%" stretchy="true" form="postfix">‚à•</mo><msub><mi>ùê±</mi><mi>i</mi></msub><mo>+</mo><msub><mi>ùêØ</mi><mi>i</mi></msub><mi mathvariant="normal">Œî</mi><mi>t</mi><mo>‚àí</mo><msub><mi>ùê±</mi><mi>j</mi></msub><msub><mo minsize="120%" maxsize="120%" stretchy="true" form="postfix">‚à•</mo><mn>2</mn></msub><mo>,</mo></mrow><annotation encoding="application/x-tex">
d_{\text{spatial}}(i, j) =
\bigl\| \mathbf{x}_i + \mathbf{v}_i \Delta t - \mathbf{x}_j \bigr\|_2,
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ùêØ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\mathbf{v}_i</annotation></semantics></math>
is the estimated velocity from previous frames.</p>
<p>We also impose a maximum displacement
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>d</mi><mi mathvariant="normal">max</mi></msub><annotation encoding="application/x-tex">d_{\max}</annotation></semantics></math>
beyond which matches are physically implausible.</p>
<p>Exact solution (moderate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>):</p>
<pre><code>// Pseudocode for particle tracking with velocity prediction

// Initialize cost matrix as forbidden everywhere
cost ‚Üê matrix(Inf, n_particles_t, n_particles_tplus)

FOR i = 1 TO n_particles_t DO
  // Predict position using previous velocity
  x_predicted ‚Üê x_t[i] + v_x_t[i] ¬∑ Œît
  y_predicted ‚Üê y_t[i] + v_y_t[i] ¬∑ Œît

  FOR j = 1 TO n_particles_tplus DO
    // Distance from predicted position
    dx ‚Üê x_predicted - x_tplus[j]
    dy ‚Üê y_predicted - y_tplus[j]
    spatial_distance ‚Üê sqrt(dx^2 + dy^2)

    // Only consider physically plausible matches
    IF spatial_distance &lt;= max_displacement THEN
      // Feature similarity (intensity, size, etc.)
      feature_distance ‚Üê |intensity_t[i] - intensity_tplus[j]|

      // Combined cost
      cost[i, j] ‚Üê Œ± ¬∑ feature_distance + Œ≤ ¬∑ spatial_distance
    END IF
  END FOR
END FOR

// Solve assignment (Inf entries are forbidden)
particle_tracks ‚Üê lap_solve(cost)

// Update velocities from assignments
FOR i = 1 TO n_particles_t DO
  j ‚Üê particle_tracks[i]
  velocity_new[i] ‚Üê (position_tplus[j] - position_t[i]) / Œît
END FOR</code></pre>
<p>For dense tracking
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>&gt;</mo><mn>5000</mn></mrow><annotation encoding="application/x-tex">n &gt; 5000</annotation></semantics></math>),
we can first cluster particles:</p>
<pre><code>// Two-stage: clustering then local matching

// Stage 1: spatial clustering
clusters_t     ‚Üê spatial_cluster(particles_t,     radius = 2 ¬∑ pixel_size)
clusters_tplus ‚Üê spatial_cluster(particles_tplus, radius = 2 ¬∑ pixel_size)

// Compute cluster representatives
FOR each cluster c DO
  centroid[c]       ‚Üê mean position of particles in c
  mean_intensity[c] ‚Üê mean intensity
  mean_velocity[c]  ‚Üê mean velocity (if available)
END FOR

// Match clusters
cluster_cost   ‚Üê compute_cluster_similarity(clusters_t, clusters_tplus)
cluster_tracks ‚Üê lap_solve(cluster_cost)

// Stage 2: within matched clusters, track individual particles
full_tracks ‚Üê []
FOR c = 1 TO n_clusters DO
  c_matched   ‚Üê cluster_tracks[c]
  particles_A ‚Üê particles in clusters_t[c]
  particles_B ‚Üê particles in clusters_tplus[c_matched]

  cost_local ‚Üê compute_particle_distance(
    particles_A, particles_B,
    max_displacement = 5,
    Œ± = 0.3,
    Œ≤ = 0.7
  )

  local_tracks ‚Üê lap_solve(cost_local)
  full_tracks  ‚Üê append(full_tracks, local_tracks)
END FOR

RETURN full_tracks</code></pre>
<p>This yields efficient and robust trajectories even for very dense
particle fields.</p>
</div>
<div class="section level3">
<h3 id="chemistry-molecular-conformation-alignment">Chemistry: Molecular Conformation Alignment<a class="anchor" aria-label="anchor" href="#chemistry-molecular-conformation-alignment"></a>
</h3>
<p><strong>Problem</strong>: align two conformations of the same
molecule (e.g.¬†a protein) with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
atoms to compute RMSD and analyze structural change.</p>
<p><strong>Feature distance</strong>: strict element matching</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mtext mathvariant="normal">element</mtext></msub><mo stretchy="false" form="prefix">(</mo><mi>i</mi><mo>,</mo><mi>j</mi><mo stretchy="false" form="postfix">)</mo><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><mn>0</mn><mo>,</mo></mtd><mtd columnalign="left" style="text-align: left"><mrow><mtext mathvariant="normal">if </mtext><mspace width="0.333em"></mspace></mrow><msub><mtext mathvariant="normal">element</mtext><mi>i</mi></msub><mo>=</mo><msub><mtext mathvariant="normal">element</mtext><mi>j</mi></msub><mo>,</mo></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mi>‚àû</mi><mo>,</mo></mtd><mtd columnalign="left" style="text-align: left"><mtext mathvariant="normal">otherwise.</mtext></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">
d_{\text{element}}(i, j) =
\begin{cases}
0, &amp; \text{if } \text{element}_i = \text{element}_j, \\
\infty, &amp; \text{otherwise.}
\end{cases}
</annotation></semantics></math></p>
<p><strong>Spatial distance</strong>: 3D Euclidean distance between
atomic coordinates.</p>
<p>Exact LAP for small molecules:</p>
<pre><code>// Pseudocode for molecular conformation alignment

n_atoms ‚Üê number of atoms in molecule
cost    ‚Üê matrix(0, n_atoms, n_atoms)

FOR i = 1 TO n_atoms DO
  FOR j = 1 TO n_atoms DO

    // Enforce strict element type matching
    IF element_type_A[i] ‚â† element_type_B[j] THEN
      cost[i, j] ‚Üê Inf
    ELSE
      dx ‚Üê x_A[i] - x_B[j]
      dy ‚Üê y_A[i] - y_B[j]
      dz ‚Üê z_A[i] - z_B[j]
      cost[i, j] ‚Üê sqrt(dx^2 + dy^2 + dz^2)
    END IF

  END FOR
END FOR

// Solve alignment
alignment ‚Üê lap_solve(cost)

// Compute RMSD
sum_sq_dist ‚Üê 0
FOR i = 1 TO n_atoms DO
  j            ‚Üê alignment[i]
  sum_sq_dist ‚Üê sum_sq_dist + cost[i, j]^2
END FOR

rmsd ‚Üê sqrt(sum_sq_dist / n_atoms)</code></pre>
<p>For large biomolecules, we again use a hierarchical strategy, this
time by secondary structure elements (helices, sheets, loops, etc.),
aligning segments first and then atoms within matched segments.</p>
</div>
</div>
<div class="section level2">
<h2 id="implementation-notes">Implementation Notes<a class="anchor" aria-label="anchor" href="#implementation-notes"></a>
</h2>
<div class="section level3">
<h3 id="customizing-morph-duration">Customizing Morph Duration<a class="anchor" aria-label="anchor" href="#customizing-morph-duration"></a>
</h3>
<p>The morphing examples use default settings, but you can customize the
number of frames and speed:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># From inst/scripts/generate_examples.R</span></span>
<span><span class="va">generate_morph</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">assignment</span>, <span class="va">pixels_A</span>, <span class="va">pixels_B</span>,</span>
<span>                           <span class="va">n_frames</span>    <span class="op">=</span> <span class="fl">30</span>,   <span class="co"># number of frames</span></span>
<span>                           <span class="va">frame_delay</span> <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>  <span class="co"># delay between frames (seconds)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">frames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="va">n_frames</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">interpolate_frame</span><span class="op">(</span><span class="va">t</span>, <span class="va">assignment</span>, <span class="va">pixels_A</span>, <span class="va">pixels_B</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu">save_gif</span><span class="op">(</span><span class="va">frames</span>, delay <span class="op">=</span> <span class="va">frame_delay</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Total animation duration is <code>n_frames * frame_delay</code>
seconds.</p>
</div>
<div class="section level3">
<h3 id="using-the-example-code">Using the Example Code<a class="anchor" aria-label="anchor" href="#using-the-example-code"></a>
</h3>
<p>The morphing implementation is provided in
<code>inst/scripts/generate_examples.R</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># View the source</span></span>
<span><span class="va">example_script</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"scripts"</span>, <span class="st">"generate_examples.R"</span>, package <span class="op">=</span> <span class="st">"couplr"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/file.show.html" class="external-link">file.show</a></span><span class="op">(</span><span class="va">example_script</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Or source to use its helpers</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="va">example_script</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply to your own data</span></span>
<span><span class="va">my_cost</span>       <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_cost_matrix.html">build_cost_matrix</a></span><span class="op">(</span><span class="va">my_data_A</span>, <span class="va">my_data_B</span><span class="op">)</span></span>
<span><span class="va">my_assignment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lap_solve.html">lap_solve</a></span><span class="op">(</span><span class="va">my_cost</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="regenerating-examples">Regenerating Examples<a class="anchor" aria-label="anchor" href="#regenerating-examples"></a>
</h3>
<p>To regenerate all demo GIFs and PNGs:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"inst/scripts/generate_examples.R"</span><span class="op">)</span></span></code></pre></div>
<p>This will write the assets under <code>inst/extdata</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="mathematical-foundation-optimal-transport">Mathematical Foundation: Optimal Transport<a class="anchor" aria-label="anchor" href="#mathematical-foundation-optimal-transport"></a>
</h2>
<p>The matching problems discussed here are discrete instances of
optimal transport.</p>
<div class="section level3">
<h3 id="monge-problem">Monge Problem<a class="anchor" aria-label="anchor" href="#monge-problem"></a>
</h3>
<p>The original Monge formulation (1781) seeks a transport map
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>:</mo><mi>A</mi><mo>‚Üí</mo><mi>B</mi></mrow><annotation encoding="application/x-tex">T: A \to B</annotation></semantics></math>
minimizing</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>‚à´</mo><mi>A</mi></msub><mi>c</mi><mo stretchy="false" form="prefix">(</mo><mi>ùê±</mi><mo>,</mo><mi>T</mi><mo stretchy="false" form="prefix">(</mo><mi>ùê±</mi><mo stretchy="false" form="postfix">)</mo><mo stretchy="false" form="postfix">)</mo><mspace width="0.167em"></mspace><mi mathvariant="normal">d</mi><mi>Œº</mi><mo stretchy="false" form="prefix">(</mo><mi>ùê±</mi><mo stretchy="false" form="postfix">)</mo><mi>.</mi></mrow><annotation encoding="application/x-tex">
\int_A c(\mathbf{x}, T(\mathbf{x})) \,\mathrm{d}\mu(\mathbf{x}).
</annotation></semantics></math></p>
</div>
<div class="section level3">
<h3 id="kantorovich-relaxation">Kantorovich Relaxation<a class="anchor" aria-label="anchor" href="#kantorovich-relaxation"></a>
</h3>
<p>Kantorovich (1942) relaxed this to a transport plan
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ≥</mi><annotation encoding="application/x-tex">\gamma</annotation></semantics></math>
on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>√ó</mo><mi>B</mi></mrow><annotation encoding="application/x-tex">A \times B</annotation></semantics></math>:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><munder><mi mathvariant="normal">min</mi><mi>Œ≥</mi></munder><msub><mo>‚à´</mo><mrow><mi>A</mi><mo>√ó</mo><mi>B</mi></mrow></msub><mi>c</mi><mo stretchy="false" form="prefix">(</mo><mi>ùê±</mi><mo>,</mo><mi>ùê≤</mi><mo stretchy="false" form="postfix">)</mo><mspace width="0.167em"></mspace><mi mathvariant="normal">d</mi><mi>Œ≥</mi><mo stretchy="false" form="prefix">(</mo><mi>ùê±</mi><mo>,</mo><mi>ùê≤</mi><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">
\min_{\gamma} \int_{A \times B} c(\mathbf{x}, \mathbf{y}) \,\mathrm{d}\gamma(\mathbf{x}, \mathbf{y})
</annotation></semantics></math></p>
<p>subject to marginal constraints on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ≥</mi><annotation encoding="application/x-tex">\gamma</annotation></semantics></math>.</p>
</div>
<div class="section level3">
<h3 id="discrete-linear-assignment">Discrete Linear Assignment<a class="anchor" aria-label="anchor" href="#discrete-linear-assignment"></a>
</h3>
<p>For discrete uniform distributions with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
points in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>B</mi><annotation encoding="application/x-tex">B</annotation></semantics></math>
we obtain exactly the linear assignment problem:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><munder><mi mathvariant="normal">min</mi><mrow><mi>œÄ</mi><mo>‚àà</mo><msub><mi>S</mi><mi>n</mi></msub></mrow></munder><munderover><mo>‚àë</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>c</mi><mrow><mi>i</mi><mo>,</mo><mi>œÄ</mi><mo stretchy="false" form="prefix">(</mo><mi>i</mi><mo stretchy="false" form="postfix">)</mo></mrow></msub><mo>,</mo></mrow><annotation encoding="application/x-tex">
\min_{\pi \in S_n} \sum_{i=1}^n c_{i,\pi(i)},
</annotation></semantics></math></p>
<p>which is what <code>couplr</code> solves efficiently.</p>
</div>
<div class="section level3">
<h3 id="wasserstein-distance">Wasserstein Distance<a class="anchor" aria-label="anchor" href="#wasserstein-distance"></a>
</h3>
<p>With
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mi>d</mi><mo stretchy="false" form="prefix">(</mo><msub><mi>ùê±</mi><mi>i</mi></msub><mo>,</mo><msub><mi>ùê±</mi><mi>j</mi></msub><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">c_{ij} = d(\mathbf{x}_i, \mathbf{x}_j)</annotation></semantics></math>
(often Euclidean distance), the optimal cost defines the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math>‚ÄëWasserstein
distance:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mn>1</mn></msub><mo stretchy="false" form="prefix">(</mo><mi>Œº</mi><mo>,</mo><mi>ŒΩ</mi><mo stretchy="false" form="postfix">)</mo><mo>=</mo><munder><mi mathvariant="normal">min</mi><mrow><mi>œÄ</mi><mo>‚àà</mo><msub><mi>S</mi><mi>n</mi></msub></mrow></munder><munderover><mo>‚àë</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>c</mi><mrow><mi>i</mi><mo>,</mo><mi>œÄ</mi><mo stretchy="false" form="prefix">(</mo><mi>i</mi><mo stretchy="false" form="postfix">)</mo></mrow></msub><mi>.</mi></mrow><annotation encoding="application/x-tex">
W_1(\mu, \nu) = \min_{\pi \in S_n} \sum_{i=1}^n c_{i,\pi(i)}.
</annotation></semantics></math></p>
<p>This appears in</p>
<ul>
<li>Earth mover‚Äôs distance for image retrieval<br>
</li>
<li>Distributional similarity in statistics<br>
</li>
<li>Generative modeling (e.g.¬†Wasserstein GANs)</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="further-reading">Further Reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h2>
<div class="section level3">
<h3 id="optimal-transport-theory">Optimal Transport Theory<a class="anchor" aria-label="anchor" href="#optimal-transport-theory"></a>
</h3>
<ul>
<li>Peyr√©, G., &amp; Cuturi, M. (2019). <em>Computational Optimal
Transport</em>. Foundations and Trends in Machine Learning.<br>
</li>
<li>Villani, C. (2008). <em>Optimal Transport: Old and New</em>.
Springer.</li>
</ul>
</div>
<div class="section level3">
<h3 id="scientific-applications">Scientific Applications<a class="anchor" aria-label="anchor" href="#scientific-applications"></a>
</h3>
<p><strong>Ecology</strong></p>
<ul>
<li>Anderson, M. J. et al.¬†(2011). Navigating the multiple meanings of
beta diversity. <em>Ecology Letters</em>.<br>
</li>
<li>Legendre, P., &amp; Legendre, L. (2012). <em>Numerical Ecology</em>.
Elsevier.</li>
</ul>
<p><strong>Physics</strong></p>
<ul>
<li>Adrian, R. J., &amp; Westerweel, J. (2011). <em>Particle Image
Velocimetry</em>. Cambridge University Press.<br>
</li>
<li>Crocker, J. C., &amp; Grier, D. G. (1996). Methods of digital video
microscopy. <em>Journal of Colloid and Interface Science</em>.</li>
</ul>
<p><strong>Chemistry</strong></p>
<ul>
<li>Kabsch, W. (1976). A solution for the best rotation to relate two
sets of vectors. <em>Acta Crystallographica</em>.<br>
</li>
<li>Coutsias, E. A. et al.¬†(2004). Using quaternions to calculate RMSD.
<em>Journal of Computational Chemistry</em>.</li>
</ul>
</div>
<div class="section level3">
<h3 id="assignment-algorithms">Assignment Algorithms<a class="anchor" aria-label="anchor" href="#assignment-algorithms"></a>
</h3>
<ul>
<li>Burkard, R., Dell‚ÄôAmico, M., &amp; Martello, S. (2009).
<em>Assignment Problems</em>. SIAM.<br>
</li>
<li>For implementation details in this package see
<code><a href="../articles/algorithms.html">vignette("algorithms")</a></code>.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="connection-to-couplr-workflows">Connection to couplr Workflows<a class="anchor" aria-label="anchor" href="#connection-to-couplr-workflows"></a>
</h2>
<p>The approximation strategies in this vignette become relevant when
working with couplr‚Äôs practical matching functions.</p>
<div class="section level3">
<h3 id="when-do-these-strategies-apply">When Do These Strategies Apply?<a class="anchor" aria-label="anchor" href="#when-do-these-strategies-apply"></a>
</h3>
<table style="width:100%;" class="table">
<colgroup>
<col width="22%">
<col width="48%">
<col width="28%">
</colgroup>
<thead><tr class="header">
<th>Strategy</th>
<th>couplr Implementation</th>
<th>When to Use</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Exact LAP</td>
<td><code>match_couples(method = "jv")</code></td>
<td>n &lt; 3,000</td>
</tr>
<tr class="even">
<td>Feature quantization</td>
<td>Implicit via <code>scale = "robust"</code>
</td>
<td>Reduces effective feature space</td>
</tr>
<tr class="odd">
<td>Hierarchical</td>
<td><code>matchmaker(block_type = "cluster")</code></td>
<td>n &gt; 3,000, use blocking</td>
</tr>
<tr class="even">
<td>Resolution reduction</td>
<td>Custom code</td>
<td>Very large n</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="practical-recommendations">Practical Recommendations<a class="anchor" aria-label="anchor" href="#practical-recommendations"></a>
</h3>
<p><strong>For n &lt; 3,000</strong>: Use <code><a href="../reference/match_couples.html">match_couples()</a></code>
with exact algorithms:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span><span class="va">left</span>, <span class="va">right</span>, vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span><span class="op">)</span>, auto_scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><strong>For 3,000 &lt; n &lt; 10,000</strong>: Use blocking to create
smaller subproblems:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">blocks</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchmaker.html">matchmaker</a></span><span class="op">(</span><span class="va">left</span>, <span class="va">right</span>, block_type <span class="op">=</span> <span class="st">"cluster"</span>, n_blocks <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_couples.html">match_couples</a></span><span class="op">(</span><span class="va">blocks</span><span class="op">$</span><span class="va">left</span>, <span class="va">blocks</span><span class="op">$</span><span class="va">right</span>, vars <span class="op">=</span> <span class="va">vars</span>, block_id <span class="op">=</span> <span class="st">"block_id"</span><span class="op">)</span></span></code></pre></div>
<p><strong>For n &gt; 10,000</strong>: Use greedy matching:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/greedy_couples.html">greedy_couples</a></span><span class="op">(</span><span class="va">left</span>, <span class="va">right</span>, vars <span class="op">=</span> <span class="va">vars</span>, strategy <span class="op">=</span> <span class="st">"sorted"</span><span class="op">)</span></span></code></pre></div>
<p><strong>For n &gt; 50,000</strong>: Combine strategies‚Äîblocking +
greedy within blocks, or implement custom approximations using the
techniques in this vignette.</p>
</div>
<div class="section level3">
<h3 id="limitations-of-approximation-strategies">Limitations of Approximation Strategies<a class="anchor" aria-label="anchor" href="#limitations-of-approximation-strategies"></a>
</h3>
<p>Each approximation trades accuracy for speed. Know the failure
modes:</p>
<table class="table">
<colgroup>
<col width="25%">
<col width="43%">
<col width="30%">
</colgroup>
<thead><tr class="header">
<th>Strategy</th>
<th>Works Well When</th>
<th>Fails When</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Feature quantization</td>
<td>Features cluster naturally</td>
<td>Continuous features, fine distinctions matter</td>
</tr>
<tr class="even">
<td>Hierarchical</td>
<td>Spatial locality is meaningful</td>
<td>Optimal matches cross boundaries</td>
</tr>
<tr class="odd">
<td>Resolution reduction</td>
<td>Coarse structure suffices</td>
<td>Fine detail matters</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>This vignette explored optimal matching through the lens of pixel
morphing and scientific applications.</p>
<p><strong>Key Ideas</strong>:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Assignment = matching</strong>: LAP finds optimal
correspondences between two sets</li>
<li>
<strong>Scalability matters</strong>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false" form="prefix">(</mo><msup><mi>n</mi><mn>3</mn></msup><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">O(n^3)</annotation></semantics></math>
becomes prohibitive for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>&gt;</mo><mn>3</mn><mo>,</mo><mn>000</mn></mrow><annotation encoding="application/x-tex">n &gt; 3{,}000</annotation></semantics></math>
</li>
<li>
<strong>Three approximations</strong>: Feature quantization,
hierarchical decomposition, resolution reduction</li>
<li>
<strong>Same math, different domains</strong>: Pixels, particles,
plots, and atoms all use the same algorithms</li>
</ol>
<p>The same algorithms that morph images smoothly also track particles
in physics, align molecules in chemistry, and match vegetation plots in
ecology. Together, the methods in <code>couplr</code> let you move
between exact optimal matchings and principled approximations, depending
on problem size and accuracy requirements.</p>
<hr>
</div>
<div class="section level2">
<h2 id="see-also">See Also<a class="anchor" aria-label="anchor" href="#see-also"></a>
</h2>
<ul>
<li>
<code><a href="../articles/getting-started.html">vignette("getting-started")</a></code> - Basic LAP solving</li>
<li>
<code><a href="../articles/algorithms.html">vignette("algorithms")</a></code> - Mathematical foundations</li>
<li>
<code><a href="../articles/matching-workflows.html">vignette("matching-workflows")</a></code> - Production matching
pipelines</li>
<li>
<code><a href="../reference/lap_solve.html">?lap_solve</a></code>, <code><a href="../reference/match_couples.html">?match_couples</a></code>,
<code><a href="../reference/greedy_couples.html">?greedy_couples</a></code>
</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by First Last.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
